rm(list=ls(0))
rm(list=ls())
# Author: Francisco Rios
# Date: Last modified July 12, 2021
# Purpose: Set up R for prepping UW PHI Vaccination Data
###############################
# load required packages
###############################
library(data.table)
library(ggplot2)
library(readxl)
###############################
# important variables
###############################
shared_data_dir <- "G:/.shortcut-targets-by-id/1P7ITMVB9x01fuYfHW8-uWogw4SpbuvwO/Merck Vaccine Improvement Index Project/Data"
local_data_dir <- "G:/My Drive/PHI/local_data"
###############################
# source shared functions
###############################
local_dir
local_dir
local_data_dir
#Read in list of files to prep
file_list = data.table(read_excel(paste0(local_data_dir, "data_file_list.xlsx")))
#Read in list of files to prep
file_list = data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
View(file_list)
local_data_di
folder
local_data_dir
if (file_list$data_type[i]=="vaccination_trends") {
folder = "vaccination_trends"
} else if (file_list$data_type[i] == "sdi" )
folder = "sdi"
i <- 1
if (file_list$data_type[i]=="vaccination_trends") {
folder = "vaccination_trends"
} else if (file_list$data_type[i] == "sdi" )
folder = "sdi"
folder
i
if (file_list$data_type[i]=="vaccination_trends") {
folder = "vaccination_trends"
} else if (file_list$data_type[i] == "sdi" )
folder = "sdi"
#Read in list of files to prep
file_list = data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
i <- 1
i
if (file_list$data_type[i]=="vaccination_trends") {
folder = "vaccination_trends"
} else if (file_list$data_type[i] == "sdi" )
folder = "sdi"
folder
if (file_list$data_type[i]=="vaccination_trends") {
file_dir = paste0(local_data_dir, folder, '/', file_list$data_source[i] )
}
file_dir
if (file_list$data_type[i]=="vaccination_trends") {
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i] )
}
file_dir
if (file_list$data_type[i]=="vaccination_trends") {
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
}
file_dir
file_list
dir
dir = file_dir
inFile = file_list$file_name[i]
sheet_name = file_list$sheet[i]
dir
inFile
sheet_name
rm(list=ls())
# Author: Francisco Rios
# Date: Last modified July 12, 2021
# Purpose: Set up R for prepping UW PHI Vaccination Data
###############################
# load required packages
###############################
library(data.table)
library(ggplot2)
library(readxl)
###############################
# important variables
###############################
shared_data_dir <- "G:/.shortcut-targets-by-id/1P7ITMVB9x01fuYfHW8-uWogw4SpbuvwO/Merck Vaccine Improvement Index Project/Data"
local_data_dir <- "G:/My Drive/PHI/local_data"
###############################
# source shared functions
###############################
#Read in list of files to prep
file_list = data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
i <- 1
# Set up file path
if (file_list$data_type[i]=="vaccination_trends") {
folder = "vaccination_trends"
} else if (file_list$data_type[i] == "sdi" )
folder = "sdi"
if (file_list$data_type[i]=="vaccination_trends") {
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
}
i
# # # TROUBLESHOOTING HELP
dir = file_dir
inFile = file_list$file_name[i]
sheet_name = file_list$sheet[i]
sheet_name
inFile
dir
# Load data
if (data_type == 'vaccination_trends'){
vax_data = data.table(read.xlsx(paste0(dir,inFile), sheet=sheet_name, detectDates=TRUE))
} else {
stop('Not a valid file iteration value.')
}
data_type = file_list$data_type[i]
# Load data
if (data_type == 'vaccination_trends'){
vax_data = data.table(read.xlsx(paste0(dir,inFile), sheet=sheet_name, detectDates=TRUE))
} else {
stop('Not a valid file iteration value.')
}
# Load data
if (data_type == 'vaccination_trends'){
vax_data = data.table(read.csv(paste0(dir,inFile), sheet=sheet_name, detectDates=TRUE))
} else {
stop('Not a valid file iteration value.')
}
paste0(dir,inFile)
# Load data
if (data_type == 'vaccination_trends'){
vax_data = data.table(read.csv(paste0(dir,inFile), detectDates=TRUE))
} else {
stop('Not a valid file iteration value.')
}
??read.csv
# Load data
if (data_type == 'vaccination_trends'){
vax_data = data.table(read.csv(paste0(dir,inFile)))
} else {
stop('Not a valid file iteration value.')
}
View(vax_data)
paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
common_dir
code_dir <- "./"
code_dir
###############################
# source shared functions
###############################
source(paste0(code_dir, "functions/", "global_variables.R"))
###############################
# source shared functions
###############################
source(paste0(code_dir, "functions/", "prep_vax_trend_data.R"))
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
file_dir
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
rm(list=ls())
# Author: Francisco Rios
# Purpose: Set up R for prepping UW PHI Vaccination Data
# Date: Last modified July 12, 2021
###############################
# load required packages
###############################
library(data.table)
library(ggplot2)
library(readxl)
###############################
# important variables
###############################
shared_data_dir <- "G:/.shortcut-targets-by-id/1P7ITMVB9x01fuYfHW8-uWogw4SpbuvwO/Merck Vaccine Improvement Index Project/Data"
local_data_dir <- "G:/My Drive/PHI/local_data"
code_dir <- "./"
###############################
# source shared functions
###############################
source(paste0(code_dir, "functions/", "prep_vax_trend_data.R"))
###############################
# set Boolean switches
##############################
# Read in list of files to prep
file_list = data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
# subset files to vaccine trends
file_list <- file_list[data_type=="vaccination_trends"]
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
file_dir
file_dir = paste0(local_data_dir, '/', folder, '/', file_list$data_source[i], '/' )
file_dir = paste0(local_data_dir, '/', file_list$data_source[i], '/' )
file_dir
# Author: Francisco Rios
# Purpose: Prep Vaccination coverage data for analyses
# Date: Last modified July 13, 2021
####### read in vaccine trend data
# Read in list of files to prep
file_list <- data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
# subset files to vaccine trends
file_list <- file_list[data_type=="vaccination_trends"]
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
# Read in list of files to prep
file_list <- data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
# subset files to vaccine trends
file_list <- file_list[data_type=="vaccination_trends"]
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
paste0(local_data_dir, '/', file_list$data_source[i], '/' )
paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
i
paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
file_dir
# Read in list of files to prep
file_list <- data.table(read_excel(paste0(local_data_dir, "/data_file_list.xlsx")))
# subset files to vaccine trends
file_list <- file_list[data_type=="vaccination_trends"]
View(file_list)
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
i <- 1
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type, '/', file_list$data_source[i], '/' )
file_dir
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type[i], '/', file_list$data_source[i], '/' )
file_dir
for(i in 1:nrow(file_list)){
# Set up file path
file_dir = paste0(local_data_dir, '/',file_list$data_type[i], '/', file_list$data_source[i], '/' )
# set up arguments
args <- list(file_dir, file_list$file_name[i], file_list$sheet[i], file_list$data_type[i])
### RUN THE PREP FUNCTION HERE ###
tmpData = do.call(prep_vax_trend_data, args)
#Add indexing data
append_cols = file_list[i, .(file_name, data_type, data_source, disease)]
stopifnot(nrow(append_cols)==1)
tmpData = cbind(tmpData, append_cols)
#Bind data together
if(i==1){
prepped_vax_data = tmpData
} else {
prepped_vax_data = rbind(prepped_vax_data, tmpData, use.names=TRUE, fill = TRUE)
}
print(paste0(i, " ", file_list$data_type[i], " ", file_list$disease[i], " ", file_list$file_name[i])) ## if the code breaks, you know which file it broke on
}
View(prepped_vax_data)
